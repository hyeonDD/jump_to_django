<!-- -
![](https://github.com/hyeonDD/jump_to_django/blob/main/4_Part/4_8_Part/django.png)
-->
# WSGI
장고 서버를 구동하기 위해 지금까지는 python manager.py runserver 처럼 장고의 내장 서버를 구동하는 방식을 사용했다.

장고의 내장 서버는 이번 장에서 설명할 웹 서버와 WSGI 서버의 기능을 모두 포함하고 있다. 다만 내장 서버는 기능이 단순하고 '대량 요청'이나 '동시 요청'을 효율적으로 처리하지 못하므로 운영 환경에는 적합하지 않다.

이번에는 개발 환경이 아닌 운영 환경에서 어떻게 서버를 구동해야 하는지 알아보자.

## 웹 브라우저
사용자는 파이보 시스템에 접속하기 위해 웹 브라우저를 이용하여 파이보 홈페이지에 접속한다. 이 때 웹 브라우저는 파이보의 웹 서버에 페이지를 요청한다.

웹 브라우저가 파이보 웹서버에 요청하는 페이지는 크게 두 가지로 분류된다.

정적 페이지
동적 페이지
정적(static) 페이지
웹 브라우저로 다음 URL을 요청해 보자.

http://3.35.153.92:8000/static/style.css
그러면 웹 브라우저 화면에 다음과 같은 내용이 그대로 출력될 것이다.

.comment {
    border-top:dotted 1px #ddd;
    font-size:0.7em;
}
파이보 서버는 위와 같은 웹 브라우저의 요청을 받으면 서버의 /static/style.css 파일을 읽어서 리턴한다. style.css는 파일이므로 항상 변하지 않는 동일한 값을 리턴할 것이다. 확장자명이 js인 자바스크립트나 jpg, png와 같은 이미지 파일도 마찬가지이다. 이런 파일들을 정적 파일(static file)이라고 한다.

이렇게 웹 브라우저에서 css, js, jpg, png와 같은 정적 파일을 요청하는 것을 정적 페이지 요청이라고 한다.

## 동적(dynamic) 페이지
이번에는 웹 브라우저가 파이보 메인페이지(http://3.35.153.92:8000/)를 요청하는 경우를 생각해 보자. 파이보 서버는 이런 요청이 들어오면 질문 목록을 조회하여 리턴한다. 이때 응답 데이터인 질문 목록은 데이터베이스의 내용에 따라 수시로 변한다.

이렇게 응답이 수시로 변하는 요청을 동적 페이지 요청이라고 한다.

## 웹 서버(Web Server)
웹 서버는 웹 브라우저의 정적 요청과 동적 요청을 처리하는 서버이다.

대표 적인 웹 서버에는 아파치(Apache), 엔진엑스(Nginx) 등이 있다. 파이보는 장고와 가장 잘 어울리는 엔진엑스(Nginx)를 웹 서버로 사용할 것이다.

웹 서버에 정적 페이지 요청이 들어오면 정적 파일을 읽어 응답하면 되므로 간단하다.

하지만 동적 페이지 요청은 조금 복잡하다.

웹 서버에 동적 페이지 요청이 들어오면 웹 서버는 파이썬 프로그램을 호출해야 한다. 예를 들어 질문 목록 페이지 요청이 들어오면 질문 목록을 조회하여 리턴하는 파이썬 프로그램을 호출해야 한다. 하지만 대부분의 웹 서버는 파이썬 프로그램을 호출할 수 있는 기능이 없다. 어떻게 파이썬 프로그램을 호출해야 하는지 모르기 때문이다.

이러한 이유로 파이썬 프로그램을 호출하는 WSGI(web server gateway interface) 서버가 반드시 필요하다. 웹 서버에 동적 요청이 발생하면 웹 서버가 WSGI 서버를 호출하고, WSGI 서버는 파이썬 프로그램을 호출하여 동적 페이지 요청을 대신 처리하는 것이다.

WSGI는 위스키라고 읽는다.

## WSGI 서버
WSGI 서버는 웹서버가 동적 페이지 요청을 처리하기 위해 호출하는 서버이다. WSGI 서버에는 여러 종류가 있지만 uwsgi와 Gunicorn을 가장 많이 사용한다. 파이보는 Gunicorn을 사용할 것이다.

웹서버에 동적 페이지 요청이 발생하면 웹 서버는 WSGI 서버를 호출하고 WSGI 서버는 다시 WSGI 애플리케이션을 호출한다. 여기서 알수 있는 중요한 사실은 실제 동적 페이지 요청은 결국 WSGI 애플리케이션이 처리한다는 점이다. WSGI 애플리케이션에는 장고(Django), 플라스크(Flask), 토네이도(Tornado) 등이 있다. 파이보 시스템이 사용할 WSGI 애플리케이션은 우리가 지금껏 공부해온 장고이다.

WSGI 서버는 웹 서버와 WSGI 애플리케이션 중간에 위치한다. 그래서 WSGI 서버는 WSGI 미들웨어(middleware) 또는 WSGI 컨테이너(container)라고도 한다.

## WSGI 애플리케이션
WSGI 서버는 항상 다음 파일을 경유하여 장고(django) 프로그램을 호출한다.

[파일명: C:\projects\mysite\config\wsgi.py]

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'config.settings')

application = get_wsgi_application()
이 파일에 선언된 application이 바로 장고의 애플리케이션이다. 이 파일은 장고 프로젝트 생성시 자동으로 만들어지며 특별한 경우가 아니고는 수정할 필요가 없다.

WSGI 순서도
다음은 지금까지 설명한 내용을 그림으로 나타낸 것이다.

![4-08_1.png](https://github.com/hyeonDD/jump_to_django/blob/main/4_Part/4_8_Part/4-08_1.png)

웹 브라우저의 정적 페이지 요청은 웹 서버가 처리하고, 동적 페이지 요청은 [WSGI 서버 → WSGI 애플리케이션]으로 처리한다. 위 그림의 과정은 이어지는 챕터들을 통해 더 자세히 알아볼 것이다.